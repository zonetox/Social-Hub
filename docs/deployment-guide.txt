# üöÄ Complete Deployment Guide - Social Hub

## üìã Overview

This guide will walk you through deploying Social Hub from scratch to production.

**Tech Stack:**
- Frontend: Next.js 14 + TypeScript + Tailwind CSS
- Backend: Supabase (PostgreSQL + Auth + Storage)
- Deployment: Vercel
- Repository: GitHub

**Timeline:** ~30-45 minutes

---

## üéØ Pre-Deployment Checklist

- [ ] GitHub account
- [ ] Supabase account
- [ ] Vercel account
- [ ] Node.js 18+ installed
- [ ] Git installed

---

## üìÅ Step 1: Create Project Structure

### 1.1 Initialize Project

```bash
# Create project directory
mkdir social-hub
cd social-hub

# Initialize Next.js project
npx create-next-app@14 . --typescript --tailwind --app --no-src-dir

# Install dependencies
npm install @supabase/supabase-js @supabase/auth-helpers-nextjs
npm install zod clsx lucide-react recharts date-fns
```

### 1.2 Create Directory Structure

```bash
mkdir -p src/{app,components,lib,types}
mkdir -p src/app/{api,\(auth\),\(dashboard\)}
mkdir -p src/components/{auth,dashboard,profile,admin,ui,shared}
mkdir -p src/lib/{supabase,hooks,utils}
mkdir -p supabase/migrations
```

### 1.3 Copy All Code Files

Create all the files from the artifacts I provided:

**Core Files:**
- `src/types/database.types.ts`
- `src/types/user.types.ts`
- `src/lib/supabase/client.ts`
- `src/lib/supabase/server.ts`
- `src/lib/utils/constants.ts`
- `src/lib/utils/validation.ts`
- `src/lib/utils/formatting.ts`
- `src/lib/hooks/useAuth.ts`
- `src/lib/hooks/useProfile.ts`

**Components:**
- All UI components (`Button`, `Input`, `Modal`, `Card`, `Badge`)
- All auth components (`LoginForm`, `RegisterForm`)
- All dashboard components (`Navbar`, `UserCard`)
- All profile components
- All admin components

**Pages:**
- `src/app/page.tsx` (Landing page)
- `src/app/(auth)/login/page.tsx`
- `src/app/(auth)/register/page.tsx`
- `src/app/(dashboard)/hub/page.tsx`
- `src/app/(dashboard)/profile/page.tsx`
- `src/app/(dashboard)/settings/page.tsx`
- `src/app/(dashboard)/admin/page.tsx`
- `src/app/(dashboard)/admin/users/page.tsx`
- `src/app/(dashboard)/admin/analytics/page.tsx`
- `src/app/[username]/page.tsx`
- `src/app/not-found.tsx`

**Config Files:**
- `next.config.js`
- `tailwind.config.ts`
- `tsconfig.json`
- `package.json`
- `.gitignore`
- `src/middleware.ts`

---

## üóÑÔ∏è Step 2: Setup Supabase Database

### 2.1 Create Supabase Project

1. Go to [supabase.com](https://supabase.com)
2. Click **"New Project"**
3. Fill in:
   - **Name:** social-hub
   - **Database Password:** (save this securely)
   - **Region:** Choose closest to your users
   - **Pricing Plan:** Free tier
4. Click **"Create new project"**
5. Wait 2-3 minutes for setup

### 2.2 Run Database Migration

1. In Supabase dashboard, go to **SQL Editor**
2. Click **"New query"**
3. Copy entire content from `supabase/migrations/20240101000000_initial_schema.sql`
4. Paste into editor
5. Click **"Run"** (or press Ctrl/Cmd + Enter)
6. Verify success message

### 2.3 Create Storage Buckets

1. Go to **Storage** in left sidebar
2. Click **"New bucket"**
3. Create **avatars** bucket:
   - Name: `avatars`
   - Public: ‚úÖ Yes
   - File size limit: 5 MB
   - Allowed MIME types: `image/*`
4. Create **covers** bucket (same settings)

### 2.4 Setup Storage Policies

Go to **SQL Editor** and run:

```sql
-- Avatars bucket policies
CREATE POLICY "Public avatars are readable"
  ON storage.objects FOR SELECT
  USING (bucket_id = 'avatars');

CREATE POLICY "Users can upload own avatar"
  ON storage.objects FOR INSERT
  WITH CHECK (
    bucket_id = 'avatars' 
    AND auth.uid()::text = (storage.foldername(name))[1]
  );

CREATE POLICY "Users can update own avatar"
  ON storage.objects FOR UPDATE
  USING (
    bucket_id = 'avatars' 
    AND auth.uid()::text = (storage.foldername(name))[1]
  );

CREATE POLICY "Users can delete own avatar"
  ON storage.objects FOR DELETE
  USING (
    bucket_id = 'avatars' 
    AND auth.uid()::text = (storage.foldername(name))[1]
  );

-- Covers bucket policies (same structure)
CREATE POLICY "Public covers are readable"
  ON storage.objects FOR SELECT
  USING (bucket_id = 'covers');

CREATE POLICY "Users can upload own cover"
  ON storage.objects FOR INSERT
  WITH CHECK (
    bucket_id = 'covers' 
    AND auth.uid()::text = (storage.foldername(name))[1]
  );

CREATE POLICY "Users can update own cover"
  ON storage.objects FOR UPDATE
  USING (
    bucket_id = 'covers' 
    AND auth.uid()::text = (storage.foldername(name))[1]
  );

CREATE POLICY "Users can delete own cover"
  ON storage.objects FOR DELETE
  USING (
    bucket_id = 'covers' 
    AND auth.uid()::text = (storage.foldername(name))[1]
  );
```

### 2.5 Get API Credentials

1. Go to **Settings** ‚Üí **API**
2. Copy these values (you'll need them):
   - **Project URL:** `https://xxxxx.supabase.co`
   - **anon/public key:** Long string starting with `eyJ...`
   - **service_role key:** (‚ö†Ô∏è Keep this secret!)

### 2.6 Configure Authentication

1. Go to **Authentication** ‚Üí **URL Configuration**
2. Add **Site URL:** `http://localhost:3000` (for development)
3. Add **Redirect URLs:**
   - `http://localhost:3000/**`
   - `http://localhost:3000/auth/callback`

---

## üîß Step 3: Configure Environment Variables

### 3.1 Create .env.local

In project root, create `.env.local`:

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# App
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=Social Hub

# Admin
ADMIN_EMAIL=admin@yourdomain.com
```

**‚ö†Ô∏è Important:**
- Replace all placeholder values with your actual Supabase credentials
- Never commit `.env.local` to Git
- Keep `SUPABASE_SERVICE_ROLE_KEY` absolutely secret

---

## üß™ Step 4: Test Locally

### 4.1 Install Dependencies

```bash
npm install
```

### 4.2 Run Development Server

```bash
npm run dev
```

### 4.3 Test Core Features

Open [http://localhost:3000](http://localhost:3000)

**Test Checklist:**
- [ ] Landing page loads
- [ ] Can access `/register`
- [ ] Can create an account
- [ ] Receive confirmation email (check spam)
- [ ] Can login at `/login`
- [ ] Redirects to `/hub` after login
- [ ] Can edit profile at `/profile`
- [ ] Can add social accounts
- [ ] Can view own profile at `/[username]`
- [ ] Can search users in Hub
- [ ] Can follow/unfollow
- [ ] Settings page works

### 4.4 Create Admin User

1. Register a new account (this will be admin)
2. Go to Supabase **Authentication** ‚Üí **Users**
3. Find your user, copy the UUID
4. Go to **SQL Editor**, run:

```sql
UPDATE public.users 
SET role = 'admin', is_verified = true
WHERE id = 'paste-uuid-here';
```

5. Refresh browser, visit `/admin`
6. Verify admin panel access

---

## üåê Step 5: Deploy to Vercel

### 5.1 Push to GitHub

```bash
# Initialize git (if not already done)
git init

# Create .gitignore (should already exist)
# Verify .env.local is in .gitignore

# Add all files
git add .

# Commit
git commit -m "Initial commit - Social Hub"

# Create GitHub repo and push
# Go to github.com, create new repository
# Follow GitHub's instructions to push
git remote add origin https://github.com/yourusername/social-hub.git
git branch -M main
git push -u origin main
```

### 5.2 Deploy on Vercel

1. Go to [vercel.com](https://vercel.com)
2. Click **"Add New..."** ‚Üí **"Project"**
3. **Import Git Repository:**
   - Click **"Import"** next to your repo
   - Or paste GitHub URL

4. **Configure Project:**
   - **Framework Preset:** Next.js (auto-detected)
   - **Root Directory:** `./`
   - **Build Command:** `npm run build` (auto)
   - **Output Directory:** `.next` (auto)

5. **Environment Variables:**
   Click **"Environment Variables"**, add these:

   ```
   NEXT_PUBLIC_SUPABASE_URL = https://your-project.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY = your-anon-key
   SUPABASE_SERVICE_ROLE_KEY = your-service-role-key
   NEXT_PUBLIC_APP_URL = https://your-app.vercel.app
   NEXT_PUBLIC_APP_NAME = Social Hub
   ADMIN_EMAIL = admin@yourdomain.com
   ```

   **‚ö†Ô∏è Important:** Use your actual Vercel URL for `NEXT_PUBLIC_APP_URL`

6. Click **"Deploy"**

7. Wait 2-3 minutes for deployment

### 5.3 Update Supabase Redirect URLs

1. After deployment, copy your Vercel URL: `https://your-app.vercel.app`
2. Go to Supabase **Authentication** ‚Üí **URL Configuration**
3. Update **Site URL:** `https://your-app.vercel.app`
4. Add **Redirect URLs:**
   - `https://your-app.vercel.app/**`
   - `https://your-app.vercel.app/auth/callback`
5. Click **"Save"**

---

## ‚úÖ Step 6: Verify Production Deployment

### 6.1 Test Production Site

Visit your Vercel URL and test:

- [ ] Landing page loads
- [ ] Can register new account
- [ ] Receive confirmation email
- [ ] Can login
- [ ] Can create/edit profile
- [ ] Can add social accounts
- [ ] Profile is publicly accessible
- [ ] Can search and follow users
- [ ] Admin panel works (for admin user)
- [ ] Mobile responsive
- [ ] All images load
- [ ] All links work

### 6.2 Performance Check

Run these checks:
- [ ] Lighthouse score (aim for 90+ on all metrics)
- [ ] Core Web Vitals pass
- [ ] Pages load in < 3 seconds
- [ ] Images optimized
- [ ] No console errors

---

## üîí Step 7: Security Hardening

### 7.1 Review Supabase RLS Policies

Verify in **SQL Editor**:

```sql
-- Check RLS is enabled
SELECT schemaname, tablename, rowsecurity 
FROM pg_tables 
WHERE schemaname = 'public';

-- All tables should show rowsecurity = true
```

### 7.2 Rotate Secrets (After Initial Setup)

For production, consider:
1. Regenerating `service_role` key
2. Using Vercel's secret encryption
3. Setting up 2FA for admin accounts

### 7.3 Setup Monitoring

1. In Vercel, enable:
   - **Analytics** (free tier)
   - **Speed Insights**
   - **Error tracking**

2. In Supabase, monitor:
   - **Database usage**
   - **Auth activity**
   - **Storage usage**

---

## üé® Step 8: Custom Domain (Optional)

### 8.1 Add Domain to Vercel

1. In Vercel project, go to **Settings** ‚Üí **Domains**
2. Click **"Add"**
3. Enter your domain: `socialhub.com`
4. Follow DNS configuration instructions

### 8.2 Update Environment Variables

After domain is active:
1. Update `NEXT_PUBLIC_APP_URL` in Vercel
2. Update Supabase redirect URLs

### 8.3 Setup SSL

Vercel automatically provisions SSL certificates via Let's Encrypt.
- Certificate auto-renews
- HTTPS enforced by default
- No additional configuration needed

---

## üìä Step 9: Monitoring & Maintenance

### 9.1 Regular Checks

**Weekly:**
- [ ] Check Supabase usage (database, auth, storage)
- [ ] Review Vercel analytics
- [ ] Monitor error logs

**Monthly:**
- [ ] Review user reports
- [ ] Check performance metrics
- [ ] Update dependencies: `npm outdated`
- [ ] Backup database (Supabase auto-backs up)

### 9.2 Scaling Considerations

**When you hit limits:**

**Supabase Free Tier Limits:**
- 500 MB database
- 1 GB file storage
- 2 GB bandwidth

**Upgrade Path:**
1. Supabase Pro: $25/month
2. Vercel Pro: $20/month/user
3. Consider CDN for images

---

## üêõ Troubleshooting Common Issues

### Issue: "Failed to fetch" on login

**Solution:**
```bash
# Check environment variables
vercel env pull

# Verify Supabase URL is correct
# Redeploy: vercel --prod
```

### Issue: Images not loading

**Solution:**
1. Check storage buckets are public
2. Verify storage policies exist
3. Check `next.config.js` image domains

### Issue: RLS policy errors

**Solution:**
```sql
-- Re-run RLS policies from migration
-- Check user session: SELECT auth.uid();
```

### Issue: Redirect loop on auth

**Solution:**
1. Clear browser cookies
2. Check middleware.ts logic
3. Verify redirect URLs in Supabase

---

## üìö Additional Resources

- **Next.js Docs:** https://nextjs.org/docs
- **Supabase Docs:** https://supabase.com/docs
- **Vercel Docs:** https://vercel.com/docs
- **Tailwind CSS:** https://tailwindcss.com/docs

---

## üéâ Success Checklist

Before considering deployment complete:

- [ ] All pages load without errors
- [ ] Authentication flow works
- [ ] Database operations succeed
- [ ] File uploads work
- [ ] Public profiles are accessible
- [ ] Admin panel functions
- [ ] Mobile responsive
- [ ] Performance metrics pass
- [ ] Security hardening complete
- [ ] Monitoring enabled
- [ ] Custom domain configured (if applicable)
- [ ] Team has access credentials
- [ ] Documentation complete

---

## üö® Emergency Procedures

### Rollback Deployment

```bash
# In Vercel dashboard
# Go to Deployments
# Find previous working deployment
# Click "..." ‚Üí "Promote to Production"
```

### Database Restore

```bash
# Supabase auto-backs up daily
# Go to: Database ‚Üí Backups
# Select backup date
# Click "Restore"
```

### Emergency Contacts

- Supabase Support: support@supabase.io
- Vercel Support: https://vercel.com/support
- GitHub: https://support.github.com

---

**üéä Congratulations! Your Social Hub is now live!**

Share your deployment: `https://your-app.vercel.app`